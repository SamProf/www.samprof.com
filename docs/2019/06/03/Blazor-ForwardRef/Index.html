<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post - SamProf.Web</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/site.css" />
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container">
                <a class="navbar-brand" href="/">SamProf.Web</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse">
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="/Privacy">Privacy</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            
<h1>Post</h1>


<hr />
<h2 id="title-forwarding-refs-in-blazor-date-2019-06-03-000000-z-layout-post">title: Forwarding Refs in Blazor
date: 2019-06-03 00:00:00 Z
layout: post</h2>
<p>ForwardRef is a technique for automatically passing a ElementRef through a component to one of its children or back from children to parent or among independent components.
This is typically not necessary for most components in the application. However, it can be useful for some kinds of components, especially in reusable component libraries. The most common scenarios are described below.</p>
<h4 id="capture-references-to-elements">Capture references to elements</h4>
<p>From Blazor documentation we know that you can capture references to HTML elements in a component using the following approach:</p>
<ul>
<li>Add a <code>ref</code> attribute to the HTML element.</li>
<li>Define a field of type <code>ElementRef</code> whose name matches the value of the <code>ref</code> attribute.
The following example shows capturing a reference to the <code>username</code> <code>&lt;input&gt;</code> element:</li>
</ul>
<pre><code class="language-html">&lt;input ref=&quot;username&quot; ... /&gt;

@functions {
    ElementRef username;
}
</code></pre>
<h3 id="problematics">Problematics</h3>
<h3 id="problem-in-passing-a-elementref-to-its-children-or-another-component">Problem in passing a ElementRef to its children or another component</h3>
<p>If you try to pass the <code>ElementRef</code> to another component (children or neighbor), it will not work.
Because <code>ref</code> returns the value at the Render moment after the parameters have been applied.
The value can be applied after the following <code>StateHasChanged()</code>.</p>
<pre><code class="language-html">&lt;MyTooltipComponent targetRef=&quot;@username&quot;&gt;&lt;/MyTooltipComponent&gt;

&lt;input ref=&quot;username&quot; ... /&gt;

@functions {
    ElementRef username;
}
</code></pre>
<h3 id="problem-in-passing-a-child-elementref-to-its-parent-in-blazor">Problem in passing a child ElementRef to its parent in Blazor</h3>
<p>The same problem is reproduced when you need to get the ElementRef from the ChildContent, especially when ChildContent is not an HTML Element, but Blazor Component.</p>
<pre><code class="language-html">&lt;MyTooltipComponent Tooltip=&quot;My tooltip for h1 element&quot;&gt;
    &lt;h1&gt;&lt;/h1&gt;
&lt;/MyTooltipComponent&gt;

&lt;MyTooltipComponent Tooltip=&quot;My tooltip for MatBlazor Button&quot;&gt;
    &lt;MatButton&gt;Click me&lt;/MatButton&gt;
&lt;/MyTooltipComponent&gt;
</code></pre>
<h2 id="solution-forwardref">Solution <code>ForwardRef</code></h2>
<p>The solution is to create a store for the ElementRef and pass this as parameter to all components.</p>
<pre><code>public class ForwardRef
{
    private ElementRef _current;
    
    public ElementRef Current
    {
        get =&gt; _current;
        set =&gt; Set(value);
    }
    public void Set(ElementRef value)
    {
        _current = value;
    }
}
</code></pre>
<h3 id="solution-for-passing-a-elementref-to-its-children-or-another-component">Solution for passing a ElementRef to its children or another component</h3>
<p>When the current component wants to pass its <code>ElementRef</code> and pass it on to others, you should create ForwardRef instance and pass it to others components in parameters.</p>
<h4 id="index.razor">Index.razor</h4>
<pre><code class="language-html">&lt;MyTooltipComponent targetForwardRef=&quot;@usernameForwardRef&quot; Tooltip=&quot;My tooltip&quot;&gt;&lt;/MyTooltipComponent&gt;

&lt;input ref=&quot;usernameForwardRef.Current&quot; ... /&gt;

@functions {
    ForwardRef usernameForwardRef = new ForwardRef();
}
</code></pre>
<h4 id="mytooltipcomponent.razor">MyTooltipComponent.razor</h4>
<pre><code class="language-html">&lt;div class=&quot;my-tooltip&quot;&gt;@Tooltip&lt;/div&gt;

@functions {
    [Parameter]
    protected ForwardRef TargetForwardRef {get;set;}
    
    [Parameter]
    protected string Tooltip {get;set;}
    
    protected override async Task OnAfterRenderAsync()
    {
        // TargetForwardRef.Current will contain reference to target ElementRef 
        await js.InvokeAsync&lt;object&gt;(&quot;initTooltip&quot;, TargetForwardRef.Current);
    }
}
</code></pre>
<h3 id="solution-in-passing-a-child-elementref-to-its-parent-in-blazor">Solution in passing a child ElementRef to its parent in Blazor</h3>
<p>If you want to get a reference to a <code>ElementRef</code> of child, you should pass the <code>ForwardRef</code> to the child in which the child returns <code>ElementRef</code> to itself.</p>
<h4 id="mytooltipcomponent.razor-1">MyTooltipComponent.razor</h4>
<pre><code class="language-html">@ChildContent(TargetForwardRef)

&lt;div class=&quot;my-tooltip&quot;&gt;@Tooltip&lt;/div&gt;

@functions {
    private ForwardRef TargetForwardRef {get;set;} = new ForwardRef();
    
    [Parameter]
    protected string Tooltip {get;set;}
    
    [Parameter]
    protected RenderFragment&lt;ForwardRef&gt; ChildContent {get;set;}   
    
    
    protected override async Task OnAfterRenderAsync()
    {
        // TargetForwardRef.Current will contain reference to target ElementRef 
        await js.InvokeAsync&lt;object&gt;(&quot;initTooltip&quot;, TargetForwardRef.Current);
    }
}
</code></pre>
<p>To obtain a <code>ElementRef</code> to the Html Element.</p>
<h4 id="index.razor-1">Index.razor</h4>
<pre><code class="language-html">&lt;MyTooltipComponent Tooltip=&quot;My tooltip&quot;&gt;
    &lt;input ref=&quot;@context.Current&quot; ... /&gt;
&lt;/MyTooltipComponent&gt;
</code></pre>
<p>To obtain a <code>ElementRef</code> to the Custom Blazor Component your component should get <code>ForwardRef</code> as a parameter.</p>
<h4 id="mycustomcomponent.razor">MyCustomComponent.razor</h4>
<pre><code class="language-html">&lt;MyCustomComponent&gt;
    &lt;input ref=&quot;ForwardRef.Current&quot; ... /&gt;
&lt;/MyTooltipComponent&gt;

@functions {
    [Parameter]
    protected ForwardRef RefBack {get;set;}
    
    protected ElementRef Ref
    {
        set 
        {
            RefBack?.Set(value);
        }
    }
}
</code></pre>
<h4 id="index.razor-2">Index.razor</h4>
<pre><code class="language-html">&lt;MyTooltipComponent Tooltip=&quot;My tooltip&quot;&gt;
    &lt;MyCustomComponent RefBack=&quot;@context&quot; /&gt;
&lt;/MyTooltipComponent&gt;
</code></pre>
<h3 id="summary">Summary</h3>
<p>In my opinion, this is one of the best <code>ElementRef</code> transfer techniques among the components.
Of course, in the class, you can add events with subscription and unsubscribe, and much more, for example Observable.
That I used in the development of the <a href="https://www.matblazor.com">MatBlazor</a> components for <a href="https://www.matblazor.com/Tooltip">Tooltip</a> and <a href="https://www.matblazor.com/Menu">Menu</a>.</p>


        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2019 - SamProf.Web - <a href="/Privacy">Privacy</a>
        </div>
    </footer>

    <script src="/lib/jquery/dist/jquery.js"></script>
    <script src="/lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script src="/js/site.js?v=dLGP40S79Xnx6GqUthRF6NWvjvhQ1nOvdVSwaNcgG18"></script>

    
</body>
</html>
